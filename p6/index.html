<html>
    <head>
        <title>Flight Delays</title>
        <style>
            h1 {text-align: center}
            h2 {text-align: center}
            div {text-align: center}
        </style>
    </head>
    <h1>How often are flights delayed?</h1>
    <div id="annualChart"></div>
    <div id="carrierChart"></div>
    <div id="hourlyChart"></div>
    <script src="http://d3js.org/d3.v4.min.js"></script>
    <script src="http://dimplejs.org/dist/dimple.v2.3.0.min.js"></script>
    <script type="text/javascript">
    data = d3.csv("/data/flight_data.csv", drawAnnualChart);
    
    function drawAnnualChart(data) {
        d3.select("#annualChart")
            .append("h2")
            .text("Chance of Delay by Year")
        var svg = dimple.newSvg("#annualChart", 590, 400);
        var myChart = new dimple.chart(svg, data);
        myChart.setBounds(60, 30, 510, 305)
        var x = myChart.addTimeAxis("x", "Year", "%Y", "%Y");
        var y = myChart.addMeasureAxis("y", "DepDelay");
        y.tickFormat = ".0%";
        y.title = "% of Flights Delayed by More Than 15 Minutes";
        var mySeries = myChart.addSeries(null, dimple.plot.line);
        mySeries.aggregate = dimple.aggregateMethod.avg;
        myChart.draw();
        drawCarrierChart(data);
    };

    function drawCarrierChart(data) {
        d3.select("#carrierChart")
            .append("h2")
            .text("Chance of Delay by Airline")
        var svg = dimple.newSvg("#carrierChart", 590, 400);
        var myChart = new dimple.chart(svg, data);
        myChart.setBounds(60, 30, 510, 305)
        var x = myChart.addTimeAxis("x", "Year", "%Y", "%Y");
        var y = myChart.addMeasureAxis("y", "DepDelay");
        var z = myChart.addMeasureAxis("z", "DepDelay");
        y.tickFormat = ".0%"
        y.title = "% of Flights Delayed by More Than 15 Minutes"
        var mySeries = myChart.addSeries("UniqueCarrier", dimple.plot.bubble);
        mySeries.aggregate = dimple.aggregateMethod.avg;
//        storyboard = myChart.setStoryboard("UniqueCarrier");
        myChart.draw();
    }

    function drawCarrierChart_old(data) {
        d3.select("#carrierChart")
            .append("h2")
            .text("Chance of Delay by Airline")
        var svg = dimple.newSvg("#carrierChart", 590, 400);
        var myChart = new dimple.chart(svg, data);
        myChart.setBounds(60, 30, 510, 305)
        var x = myChart.addCategoryAxis("x", "UniqueCarrier");
        x.title = "Airline"
        var y = myChart.addMeasureAxis("y", "DepDelay");
        y.tickFormat = ".0%"
        y.title = "% of Flights Delayed by More Than 15 Minutes"
        var mySeries = myChart.addSeries("UniqueCarrier", dimple.plot.bar);
        mySeries.aggregate = dimple.aggregateMethod.avg;
        storyboard = myChart.setStoryboard("Year");
        myChart.draw();
    }
    </script>
</html>